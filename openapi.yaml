openapi: 3.0.0
info:
  title: Telegram API Service
  description: A modular Telegram API service built with TypeScript and the telegram (gramjs) library for real MTProto integration.
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://your-vercel-app.vercel.app
    description: Production server
  - url: http://localhost:3000
    description: Development server

tags:
  - name: Authentication
    description: Session validation endpoints
  - name: Channels
    description: Channel-related operations

paths:
  /api/validate-session:
    post:
      tags:
        - Authentication
      summary: Validate Telegram Session
      description: Validates a Telegram session and returns detailed user information
      operationId: validateSession
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateSessionRequest'
            examples:
              mainAccount:
                summary: Main account validation
                value:
                  accountType: main
                  apiId: 12345
                  apiHash: your-api-hash-here
                  sessionString: your-session-string-here
                  userId: "123456789"
      responses:
        '200':
          description: Session validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateSessionResponse'
              examples:
                success:
                  summary: Valid session
                  value:
                    success: true
                    isValid: true
                    userInfo:
                      id: "123456789"
                      username: johndoe
                      first_name: John
                      last_name: Doe
                      is_bot: false
                      is_premium: true
                      phone: "+1234567890"
                      about: "Hello, I'm using Telegram!"
                      common_chats_count: 5
                      blocked: false
                invalid:
                  summary: Invalid session
                  value:
                    success: false
                    isValid: false
                    error: "Session validation failed"
        '400':
          description: Bad request - Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/get-similar-channels:
    post:
      tags:
        - Channels
      summary: Get Similar Channels
      description: Returns a list of channels similar to the specified channel using Telegram's recommendation algorithm
      operationId: getSimilarChannels
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetSimilarChannelsRequest'
            examples:
              byUsername:
                summary: Get similar channels by username
                value:
                  channelId: "@channelname"
                  limit: 10
                  accountType: main
                  apiId: 12345
                  apiHash: your-api-hash-here
                  sessionString: your-session-string-here
                  userId: "123456789"
              byId:
                summary: Get similar channels by ID
                value:
                  channelId: "-1001234567890"
                  limit: 5
                  accountType: pull
                  apiId: 12345
                  apiHash: your-api-hash-here
                  sessionString: your-session-string-here
                  userId: "123456789"
      responses:
        '200':
          description: List of similar channels
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetSimilarChannelsResponse'
              examples:
                success:
                  summary: Found similar channels
                  value:
                    success: true
                    channels:
                      - id: "1234567890"
                        title: "Tech News Channel"
                        username: "technews"
                        description: "Latest technology news and updates"
                        participants_count: 15000
                        is_verified: true
                        is_scam: false
                        is_fake: false
                        type: channel
                      - id: "0987654321"
                        title: "Gadget Reviews"
                        username: "gadgetreviews"
                        participants_count: 8500
                        is_verified: false
                        is_scam: false
                        is_fake: false
                        type: channel
        '400':
          description: Bad request - Missing required fields or invalid session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingChannel:
                  value:
                    success: false
                    error: "Channel ID is required"
                invalidSession:
                  value:
                    success: false
                    error: "Valid session string is required."
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    TelegramCredentials:
      type: object
      required:
        - apiId
        - apiHash
        - sessionString
        - userId
      properties:
        apiId:
          type: integer
          description: Telegram API ID obtained from my.telegram.org
          example: 12345
        apiHash:
          type: string
          description: Telegram API Hash obtained from my.telegram.org
          example: "a1b2c3d4e5f6g7h8i9j0"
        sessionString:
          type: string
          description: Telegram session string for authentication
          example: "1BQANOmBw8fg..."
        userId:
          type: string
          description: Telegram user ID
          example: "123456789"

    ValidateSessionRequest:
      allOf:
        - $ref: '#/components/schemas/TelegramCredentials'
        - type: object
          required:
            - accountType
          properties:
            accountType:
              type: string
              enum: [main, pull]
              description: Type of account being validated
              example: main

    ValidateSessionResponse:
      type: object
      required:
        - success
        - isValid
      properties:
        success:
          type: boolean
          description: Whether the API call was successful
        isValid:
          type: boolean
          description: Whether the session is valid
        userInfo:
          type: object
          description: User information (only present if session is valid)
          properties:
            id:
              type: string
              description: User ID
            username:
              type: string
              description: Username (optional)
            first_name:
              type: string
              description: First name
            last_name:
              type: string
              description: Last name (optional)
            is_bot:
              type: boolean
              description: Whether the user is a bot
            is_premium:
              type: boolean
              description: Whether the user has Telegram Premium
            phone:
              type: string
              description: Phone number (optional)
            about:
              type: string
              description: User's about/bio text (optional)
            profile_photo:
              type: object
              description: Profile photo information (optional)
              properties:
                id:
                  type: string
                dc_id:
                  type: integer
            common_chats_count:
              type: integer
              description: Number of common chats
            blocked:
              type: boolean
              description: Whether the user is blocked
            can_pin_message:
              type: boolean
              description: Whether can pin messages
            has_private_forwards:
              type: boolean
              description: Whether has private forwards enabled
            settings:
              type: object
              description: User settings
              properties:
                report_spam:
                  type: boolean
                add_contact:
                  type: boolean
                block_contact:
                  type: boolean
                share_contact:
                  type: boolean
                report_geo:
                  type: boolean
        error:
          type: string
          description: Error message (only present if success is false)

    GetSimilarChannelsRequest:
      allOf:
        - $ref: '#/components/schemas/TelegramCredentials'
        - type: object
          required:
            - channelId
          properties:
            channelId:
              type: string
              description: Channel ID or username (e.g., "@channelname" or "-1001234567890")
              example: "@channelname"
            limit:
              type: integer
              description: Maximum number of similar channels to return
              default: 10
              minimum: 1
              maximum: 100
              example: 10
            accountType:
              type: string
              enum: [main, pull]
              description: Type of account being used
              default: pull
              example: pull

    GetSimilarChannelsResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether the API call was successful
        channels:
          type: array
          description: List of similar channels (only present if success is true)
          items:
            $ref: '#/components/schemas/TelegramChannel'
        error:
          type: string
          description: Error message (only present if success is false)

    TelegramChannel:
      type: object
      required:
        - id
        - title
        - type
      properties:
        id:
          type: string
          description: Channel ID
          example: "1234567890"
        title:
          type: string
          description: Channel title
          example: "Tech News Channel"
        username:
          type: string
          description: Channel username (optional)
          example: "technews"
        description:
          type: string
          description: Channel description (optional)
          example: "Latest technology news and updates"
        participants_count:
          type: integer
          description: Number of channel members
          example: 15000
        is_verified:
          type: boolean
          description: Whether the channel is verified
          default: false
        is_scam:
          type: boolean
          description: Whether the channel is marked as scam
          default: false
        is_fake:
          type: boolean
          description: Whether the channel is marked as fake
          default: false
        photo:
          type: object
          description: Channel photo information (optional)
        type:
          type: string
          enum: [channel, supergroup, group]
          description: Type of chat
          example: channel

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          description: Always false for errors
          example: false
        error:
          type: string
          description: Error message
          example: "Internal server error"

  securitySchemes:
    apiCredentials:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication (if implemented)

security: []  # No security by default, credentials are passed in request body